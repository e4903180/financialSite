{"ast":null,"code":"import _slicedToArray from \"/home/cosbi/financialSite/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/cosbi/financialSite/frontend/src/privateRoute.js\";\nimport React, { useState, useEffect } from 'react';\nimport { Outlet, useNavigate } from 'react-router-dom';\nimport NavbarComp from './component/navbar/navbar';\nimport axios from \"axios\";\nimport { config, WSContext } from './constant';\nimport socketio from 'socket.io-client';\nimport { Button, Modal } from 'react-bootstrap';\n\nfunction PrivateRoute() {\n  var _useState = useState(),\n      _useState2 = _slicedToArray(_useState, 2),\n      isAuth = _useState2[0],\n      setIsAuth = _useState2[1];\n\n  var _useState3 = useState(null),\n      _useState4 = _slicedToArray(_useState3, 2),\n      ws = _useState4[0],\n      setWs = _useState4[1];\n\n  var nav = useNavigate();\n\n  var _useState5 = useState(false),\n      _useState6 = _slicedToArray(_useState5, 2),\n      show = _useState6[0],\n      setShow = _useState6[1];\n\n  var handleClose = function handleClose() {\n    setShow(false);\n    nav(config[\"rootPathPrefix\"] + \"/login\");\n  };\n\n  var handleTimeout = function handleTimeout() {\n    setShow(true);\n    handleLogOut();\n  };\n\n  var handleLogOut = function handleLogOut() {\n    axios.get(config[\"rootApiIP\"] + \"/user/logout\").then(function (res) {\n      if (ws) ws.disconnect();\n    });\n  };\n\n  var event = [\"load\", \"mousemove\", \"mousedown\", \"click\", \"scroll\", \"keypress\"];\n  useEffect(function () {\n    axios.get(config[\"rootApiIP\"] + \"/data/isAuth\").then(function (res) {\n      setIsAuth(true);\n      setWs(socketio.connect(config[\"WebSocketIP\"] + res.data));\n      var timer = setTimeout(function () {\n        handleTimeout();\n      }, 14.9 * 60 * 1000);\n      event.forEach(function (item, idx) {\n        window.addEventListener(item, function () {\n          clearTimeout(timer);\n          timer = setTimeout(function () {\n            handleTimeout();\n          }, 14.9 * 60 * 1000);\n        });\n      });\n    }).catch(function (res) {\n      setIsAuth(false);\n      setShow(true);\n      setWs(null);\n    });\n  }, []);\n  if (isAuth === undefined) return null;\n  return /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(Modal, {\n    show: show,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 71,\n      columnNumber: 13\n    }\n  }, /*#__PURE__*/React.createElement(Modal.Header, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Modal.Title, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 21\n    }\n  }, \"\\u670D\\u52D9\\u4E2D\\u65B7\")), /*#__PURE__*/React.createElement(Modal.Body, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 17\n    }\n  }, \"\\u9592\\u7F6E\\u904E\\u4E45\\u8ACB\\u91CD\\u65B0\\u767B\\u5165\"), /*#__PURE__*/React.createElement(Modal.Footer, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 17\n    }\n  }, /*#__PURE__*/React.createElement(Button, {\n    variant: \"secondary\",\n    onClick: handleClose,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 79,\n      columnNumber: 21\n    }\n  }, \"\\u78BA\\u5B9A\"))), isAuth ? /*#__PURE__*/React.createElement(WSContext.Provider, {\n    value: ws,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 85,\n      columnNumber: 23\n    }\n  }, /*#__PURE__*/React.createElement(NavbarComp, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 86,\n      columnNumber: 17\n    }\n  }), /*#__PURE__*/React.createElement(Outlet, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 87,\n      columnNumber: 17\n    }\n  })) : /*#__PURE__*/React.createElement(React.Fragment, null));\n}\n\nexport default PrivateRoute;","map":{"version":3,"sources":["/home/cosbi/financialSite/frontend/src/privateRoute.js"],"names":["React","useState","useEffect","Outlet","useNavigate","NavbarComp","axios","config","WSContext","socketio","Button","Modal","PrivateRoute","isAuth","setIsAuth","ws","setWs","nav","show","setShow","handleClose","handleTimeout","handleLogOut","get","then","res","disconnect","event","connect","data","timer","setTimeout","forEach","item","idx","window","addEventListener","clearTimeout","catch","undefined"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { Outlet, useNavigate } from 'react-router-dom';\nimport NavbarComp from './component/navbar/navbar';\nimport axios from \"axios\";\nimport { config, WSContext } from './constant';\nimport socketio from 'socket.io-client'\nimport { Button, Modal } from 'react-bootstrap';\n\nfunction PrivateRoute() {\n    const [isAuth, setIsAuth] = useState()\n    const [ws, setWs] = useState(null)\n    const nav = useNavigate()\n    const [show, setShow] = useState(false);\n\n    const handleClose =() => {\n        setShow(false)\n        nav(config[\"rootPathPrefix\"] + \"/login\")\n    }\n\n    const handleTimeout = () => {\n        setShow(true)\n        handleLogOut()\n    };\n\n    const handleLogOut = () => {\n        axios.get(config[\"rootApiIP\"] + \"/user/logout\")\n        .then(res => {\n            if(ws) ws.disconnect()\n        })\n    }\n\n    const event = [\n        \"load\",\n        \"mousemove\",\n        \"mousedown\",\n        \"click\",\n        \"scroll\",\n        \"keypress\",\n    ];\n\n    useEffect(() => {\n        axios.get(config[\"rootApiIP\"] + \"/data/isAuth\")\n        .then(res => {\n            setIsAuth(true)\n            setWs(socketio.connect(config[\"WebSocketIP\"] + res.data))\n\n            let timer = setTimeout(() => {\n                handleTimeout()\n            }, 14.9 * 60 * 1000);\n    \n            event.forEach((item, idx) => {\n                window.addEventListener(item, () => {\n                    clearTimeout(timer)\n    \n                    timer = setTimeout(() => {\n                        handleTimeout()\n                    }, 14.9 * 60 * 1000);\n                });\n            })\n        }).catch(res => {\n            setIsAuth(false)\n            setShow(true)\n            setWs(null)\n        })\n    }, [])\n\n    if (isAuth === undefined) return null\n\n    return(\n        <>\n            <Modal show = { show }>\n                <Modal.Header>\n                    <Modal.Title>服務中斷</Modal.Title>\n                </Modal.Header>\n\n                <Modal.Body>閒置過久請重新登入</Modal.Body>\n\n                <Modal.Footer>\n                    <Button variant = \"secondary\" onClick = { handleClose }>\n                        確定\n                    </Button>\n                </Modal.Footer>\n            </Modal>\n\n            {isAuth ? <WSContext.Provider value = {ws}>\n                <NavbarComp /> \n                <Outlet />\n            </WSContext.Provider>\n            :<></>}\n        </> \n    )\n}\n\nexport default PrivateRoute;"]},"metadata":{},"sourceType":"module"}