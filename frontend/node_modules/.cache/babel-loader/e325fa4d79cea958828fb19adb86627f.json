{"ast":null,"code":"import _slicedToArray from \"/home/cosbi/financialSite/frontend/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";\nvar _jsxFileName = \"/home/cosbi/financialSite/frontend/src/privateRoute.js\";\nimport React, { useState, useEffect } from 'react';\nimport { Navigate, Outlet, useNavigate } from 'react-router-dom';\nimport NavbarComp from './component/navbar/navbar';\nimport axios from \"axios\";\nimport { rootApiIP, WebSocketIP, WSContext } from './constant';\nimport socketio from 'socket.io-client';\n\nfunction PrivateRoute() {\n  var _useState = useState(),\n      _useState2 = _slicedToArray(_useState, 2),\n      isAuth = _useState2[0],\n      setIsAuth = _useState2[1];\n\n  var _useState3 = useState(null),\n      _useState4 = _slicedToArray(_useState3, 2),\n      ws = _useState4[0],\n      setWs = _useState4[1];\n\n  var nav = useNavigate();\n  var events = [\"load\", \"mousemove\", \"mousedown\", \"click\", \"scroll\", \"keypress\"];\n  var timer = [];\n\n  var resetTimer = function resetTimer() {\n    for (var i = 0; i < timer.length; i++) {\n      clearTimeout(timer[i]);\n    }\n  };\n\n  var handleLogOut = function handleLogOut() {\n    axios.get(rootApiIP + \"/user/logout\").then(function (res) {\n      if (ws) ws.disconnect();\n      nav(\"/login\");\n    });\n  };\n\n  var handleLogoutTimer = function handleLogoutTimer() {\n    setTimeout(function () {\n      resetTimer(); // Listener clean up. Removes the existing event listener from the window\n\n      Object.values(events).forEach(function (item) {\n        window.removeEventListener(item, resetTimer);\n      }); // logs out user\n\n      handleLogOut();\n    }, 14.9 * 60 * 1000);\n  };\n\n  useEffect(function () {\n    axios.get(rootApiIP + \"/data/isAuth\").then(function (res) {\n      setIsAuth(true);\n      setWs(socketio.connect(WebSocketIP + res.data));\n    }).catch(function (res) {\n      setIsAuth(false);\n      setWs(null);\n    });\n  }, []);\n  useEffect(function () {\n    Object.values(events).forEach(function (item) {\n      window.addEventListener(item, function () {\n        console.log(\"in\"); // resetTimer();\n        // handleLogoutTimer();\n      });\n    });\n    console.log(timer);\n  }, []);\n  if (isAuth === undefined) return null;\n  return isAuth ? /*#__PURE__*/React.createElement(React.Fragment, null, /*#__PURE__*/React.createElement(WSContext.Provider, {\n    value: ws,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 23\n    }\n  }, /*#__PURE__*/React.createElement(NavbarComp, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 56\n    }\n  }), \" \", /*#__PURE__*/React.createElement(Outlet, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 71\n    }\n  }))) : /*#__PURE__*/React.createElement(Navigate, {\n    to: \"/login\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 108\n    }\n  });\n}\n\nexport default PrivateRoute;","map":{"version":3,"sources":["/home/cosbi/financialSite/frontend/src/privateRoute.js"],"names":["React","useState","useEffect","Navigate","Outlet","useNavigate","NavbarComp","axios","rootApiIP","WebSocketIP","WSContext","socketio","PrivateRoute","isAuth","setIsAuth","ws","setWs","nav","events","timer","resetTimer","i","length","clearTimeout","handleLogOut","get","then","res","disconnect","handleLogoutTimer","setTimeout","Object","values","forEach","item","window","removeEventListener","connect","data","catch","addEventListener","console","log","undefined"],"mappings":"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","sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { Navigate, Outlet, useNavigate } from 'react-router-dom';\nimport NavbarComp from './component/navbar/navbar';\nimport axios from \"axios\";\nimport { rootApiIP, WebSocketIP, WSContext } from './constant';\nimport socketio from 'socket.io-client'\n\nfunction PrivateRoute() {\n    const [isAuth, setIsAuth] = useState()\n    const [ws, setWs] = useState(null)\n    const nav = useNavigate()\n    const events = [\n        \"load\",\n        \"mousemove\",\n        \"mousedown\",\n        \"click\",\n        \"scroll\",\n        \"keypress\",\n    ];\n    let timer = [];\n\n    const resetTimer = () => {\n        for(let i = 0; i < timer.length; i++){\n            clearTimeout(timer[i])\n        }\n    };\n\n    const handleLogOut = () => {\n        axios.get(rootApiIP + \"/user/logout\")\n        .then(res => {\n            if(ws) ws.disconnect()\n            nav(\"/login\")\n        })\n    }\n\n    const handleLogoutTimer = () => {\n        setTimeout(() => {\n          resetTimer()\n\n          // Listener clean up. Removes the existing event listener from the window\n          Object.values(events).forEach((item) => {\n            window.removeEventListener(item, resetTimer);\n          });\n\n          // logs out user\n          handleLogOut()\n        }, 14.9 * 60 * 1000);\n    };\n\n    useEffect(() => {\n        axios.get(rootApiIP + \"/data/isAuth\")\n        .then(res => {\n            setIsAuth(true)\n            setWs(socketio.connect(WebSocketIP + res.data))\n        }).catch(res => {\n            setIsAuth(false)\n            setWs(null)\n        })\n    }, [])\n\n    useEffect(() => {\n        Object.values(events).forEach((item) => {\n            window.addEventListener(item, () => {\n                console.log(\"in\")\n                // resetTimer();\n                // handleLogoutTimer();\n            });\n        });\n        console.log(timer)\n    }, [])\n\n    if (isAuth === undefined) return null\n\n    return isAuth ? <><WSContext.Provider value = {ws}><NavbarComp /> <Outlet /></WSContext.Provider></> : <Navigate to = \"/login\" />;\n}\n\nexport default PrivateRoute;"]},"metadata":{},"sourceType":"module"}